---
title: "hy2912_p8105_hw3"
author: "Helen Yousaf"
date: "2024-10-07"
output: github_document
---
```{r}
library(readr)
library(tidyverse)
library(ggridges)
library(dplyr)
library(hexbin)
```
# Problem 1 
#### NOAA Data 

Reading the data 

```{r}
ny_noaa = read.csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/nynoaadat.csv", na = c(".", "NA", ""))
```

```{r}
ny_noaa |>
  count(snow)|>
  arrange(desc(n))
```

Data set cleaning 
```{r}
ny_noaa = 
  ny_noaa |>
  separate (date, into = c("year", "month", "day"), convert = TRUE) |>
              mutate(
                tmax = as.numeric(tmax), 
                tmin = as.numeric(tmin))
```

Plot for average maximum temperature 
```{r}
ny_noaa |>
  group_by(id, year, month)|>
  summarise(mean_tmax = mean(tmax, na.rm = TRUE, color = id))|>
  ggplot(aes(x=year, y=mean_tmax, group=id))+geom_point()+geom_path()+facet_grid(~month)+labs(title = "Mean Monthly Temperature by Station Across Years in January and July")
```
```{r}
hex = ny_noaa|>
  ggplot(aes(x=tmin, y=tmax)) + 
  geom_hex()

ridge = 
  ny_noaa |>
  filter(snow < 100, snow > 0)|>
  ggplot(aes(x=snow, y=as.factor(year)))+ geom_density_ridges()
```

```{r}
hex
```

```{r}
ridge
```

# Problem 2 
#### MIMS Data

*Data set description from prompt: This problem uses accelerometer data collected on 250 participants in the NHANES study.Accelerometers have become an appealing alternative to self-report techniques for studying physical activity in observational studies and clinical trials, largely because of their relative objectivity. During observation periods, the devices can measure MIMS in a short period; one-minute intervals are common. Because accelerometers can be worn comfortably and unobtrusively, they produce around-the-clock observations.


Importing MIMS Demographic data
```{r}
MIMS_dg_df = 
  read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/MIMS.dg.csv", 
           skip = 4, na = c(".", "NA", ""))
```

```{r}
names(MIMS_dg_df)
MIMS_dg_df = janitor::clean_names(MIMS_dg_df) |>
  mutate(
    sex = 
      case_match(
        sex, 
        1 ~ "male", 
        2 ~ "female"),
    sex = as.factor(sex)) 
```

```{r}
MIMS_dg_df |>
  mutate(
    education = 
      case_match (
        education, 
        1 ~ "less than hs", 
        2 ~ "hs equivalent",
        3 ~ "greater than hs"),
    education = as.factor(education))
```

Importing MIMS Accelerometer data 
```{r}
MIMS_ac_df = 
  read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/MIMS.ac.csv", 
           na = c(".", "NA", ""))
```

```{r}
names(MIMS_ac_df)
MIMS_ac_df = janitor::clean_names(MIMS_ac_df)
```

Joining data sets to form MIMS_comb_df
```{r}
MIMS_comb_df = 
  left_join (MIMS_dg_df, MIMS_ac_df, by = "seqn") 
```

```{r}
MIMS_comb_df = 
  drop_na(MIMS_comb_df) |>
  filter ("age" >= 21) |>
  mutate(across(c(sex, education), as.factor)
)
```

Gender and Education Summary Table 
```{r}
gender_ed_df <- MIMS_comb_df |>
  group_by(education, sex) |>
  summarise(count = n()) |>
  pivot_wider(names_from = sex, values_from = count, values_fill = 0)
```

```{r}
gender_ed_df
```
Among both females and males, the greatest proportion of riders had education qualifications above a high school degree. This was followed by a high school equivalent degree and less than high school degree for males. The opposite was true for females. 

Visualization of the Age-Sex Distribution by Education Level
```{r}
ggplot(MIMS_comb_df, aes(x = age, fill = sex)) +
  geom_histogram(position = "dodge", binwidth = 10, alpha = 0.5) +
  facet_wrap(~ education) +
  labs(title = "Age-Sex Distribution By Education Level",
       x = "Age (years)",
       y = "Count") +
  theme_minimal()
```
Among females the greatest proportion of riders with education qualifications above the high school level, most were between 20 and 30 years old. 

Total activity dataset 
```{r}
total_activity_df <- MIMS_comb_df |>
  group_by(seqn, age, sex, education) |>
  summarise(total_activity = sum(min1:min1440, na.rm = TRUE)) 
```
```{r}
total_activity_df
```

Visualization of total activities against age, by sex and education
```{r}
ggplot(total_activity_df, aes(x = age, y = total_activity, color = sex)) +
  geom_point() +
  geom_smooth(method = "loess") +
  facet_wrap(~ education) +
  labs(x = "Age", y = "Total Activity", title = "Total Activity Against Age, by Gender and Education Level") +
  theme_minimal()
```
Overall, males tended to have a higher total activity count across all education levels as compared to women. As expected, as age increased between 20 and 80 the total acitivity in minutes decreased or plateaued for both genders. 


```{r}
activity_timecourse_df <- MIMS_comb_df |>
group_by (min1:min1440, education, sex) |>
summarise (mean_activity = mean(duration), .groups = 'drop')
```

```{r}
library(ggplot2)
```


# Problem 3
#### Citi Bike Data 

* Data set description from prompt: This data set contains information on rides taken on the NYC Citi Bike system. Files contain 1% of all rides with a total duration less than 4 hours in each of four months. Citi Bike is a bike sharing system in New York City; riders can rent pedal-powered or electric bikes from starting stations and return them to another station at their destination. Introduced in 2013, the system is immensely popular and expanded rapidly. Riders who use this system often may become “members” with lower rental rates.

Loading data sets 
```{r}
Jan2020_df = read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/Jan2020.CITI.csv", na = c(".", "NA", ""))
Jul2020_df = read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/July2020.CITI.csv", na = c(".", "NA", ""))
Jan2024_df = read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/Jan2024.CITI.csv", na = c(".", "NA", ""))
Jul2024_df = read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/July2024.CITI.csv", na = c(".", "NA", ""))
```

Basic cleaning of data sets
```{r}
Jan2020_df = 
  janitor::clean_names (Jan2020_df)
```
```{r}
Jan2020_df = 
  drop_na(Jan2020_df) |>
  mutate (date = "Jan 2020")
```
```{r}
Jul2020_df = janitor::clean_names (Jul2020_df)
```
```{r}
Jul2020_df = 
  drop_na(Jul2020_df)|>
  mutate (date = "July 2020")
```
```{r}
Jan2024_df = janitor::clean_names (Jan2024_df) 
```
```{r}
Jan2024_df = 
  drop_na(Jan2024_df) |>
  mutate (date = "Jan 2024")
```
```{r}
Jul2024_df = janitor::clean_names (Jul2024_df)
```
```{r}
Jul2024_df = 
  drop_na(Jul2024_df) |> 
  mutate (date = "July 2024")
```

Binding rows to recreate one data set for Citi Bike data
```{r}
citi_df = 
  bind_rows (Jan2020_df, Jul2020_df, Jan2024_df, Jul2024_df) |>
  rename (id = ride_id, bike= rideable_type, day = weekdays, start_station = start_station_name, end_station = end_station_name, 
  rider = member_casual) 
```
```{r}
citi_df |>
   mutate(
    bike = 
      case_match(
        bike, 
        "electric_bike" ~ "electric", 
        "classic_bike" ~ "classic")
   )
```
This cleaned data set is a combined data set including logistical information: date, day of the week, and ID for all four data sets in January and July 2020 and January and July 2024 and ride information: bike type, duration, start and end station, and rider type. The resulting data set is clear of any ride information in which data was missing or not available. 


```{r}
total_rider_df <- citi_df |>
  group_by(rider, date) |>
  summarise(count = n()) |>
  pivot_wider(names_from = rider, values_from = count, values_fill = 0)
```
```{r}
total_rider_df
```

Across all four date periods, most riders were disproportionately members indicating that they were frequent riders who took advantage of the discounted pay rate. In addition, as compared to January 2020, there were many more riders in Jul 2024 for both members and casual riders. 

```{r}
pop_start_df <- citi_df |>
  group_by (date = "July 2024") |>
  summarise(count = n()) |>
  pivot_wider(names_from = date, values_from = count, values_fill = 0)
```

July 2024 data set
```{r}
Jul_2024_df <- citi_df |>
  filter(date == "July 2024")
```

Popular Stations data set
```{r}
pop_start_df <- Jul_2024_df |> 
  group_by(start_station) |>
  summarise(ride_count = n()) |>
  arrange(desc(ride_count))
```

5 Most Popular Starting Stations 
```{r}
five_pop_start_df <- head(pop_start_df, 5)
```

```{r}
five_pop_start_df
```
The five most popular start stations, as measured by the most ride counts, were Pier 61 at Chelsea Piers, University Place & East 14 Street, West 21 Street & 6th Avenue, West Street & Chambers Street, and West 31st Street & 7th Avenue. Among them, Pier 61 at Chelsea Piers was the most popular ride accumulating 163 rides. 

```{r}
median_df <- citi_df |>
separate (date, c("month", "year"))
```

Calculating median ride duration per date variable factor 
```{r}
day_median_df <- median_df |>
  group_by(day)|>
  summarise(day_median_duration = median(duration))
```

```{r}
month_median_df <- median_df |>
  group_by(month)|>
  summarize(month_median_duration = median(duration))
```

```{r}
year_median_df <- median_df |>
  group_by(year)|>
  summarize(year_median_duration = median(duration))
```

Creating individual plots 
```{r}
day_plot <- ggplot(day_median_df, aes(x = day, y = day_median_duration)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Median Ride Duration by Day of the Week",
       x = "Day of the Week",
       y = "Median Ride Duration (minutes)") +
  theme_minimal()
```
```{r}
month_plot <- ggplot(month_median_df, aes(x = month, y = month_median_duration)) +
  geom_bar(stat = "identity", fill = "green") +
  labs(title = "Median Ride Duration by Month",
       x = "Month",
       y = "Median Ride Duration (minutes)") +
  theme_minimal()
```

```{r}
year_plot <- ggplot(year_median_df, aes(x = year , y = year_median_duration)) +
  geom_bar(stat = "identity", fill = "pink") +
  labs(title = "Median Ride Duration by Year",
       x = "Year",
       y = "Median Ride Duration (minutes)") +
  theme_minimal()
```

```{r}
library(patchwork)
```

```{r}
(day_plot + month_plot) / year_plot
```
The greatest impact on ride duration appears to be caused by the month of ride (January vs July). This is expected as the difference in temperatures, is likely to incline riders to ride for a longer period of time in July as compared to January. The second most effect was caused by the year of the rides (2020 vs 2024). Given the pandemic, stay-at-home orders, and lockdowns, it is clear that people had more free time and were able to ride their bikes for longer in 2020 as compared to in 2024. The day of the week had the weakest impact on ride duration, however, there were still slight increases in duration on weekends as compared to weekdays. 

```{r}
month_ride_distribution <- ggplot(median_df, aes(x = duration)) +
  geom_histogram (binwidth = 1, fill = "blue", color = "black") +
  facet_wrap(~ month) +
  labs(title = "Distribution of Ride Duration by Month", x = "Ride Duration", y = "Count")
```

```{r}
membership_ride_distribution <- ggplot(citi_df, aes(x = duration)) +
  geom_histogram (binwidth = 1, fill = "pink", color = "blue") +
  facet_wrap(~ rider) +
  labs(title = "Distribution of Ride Duration by Membership Status", x = "Ride Duration", y = "Count")
```

```{r}
bike_ride_distribution <- ggplot(citi_df, aes(x = duration, fill = bike)) +
  geom_histogram(binwidth = 1, position = "dodge", color = "yellow") +
  labs(title = "Distribution of Ride Duration by Bike Type", x = "Ride Duration", y = "Count")
```


```{r}
(month_ride_distribution + membership_ride_distribution) / bike_ride_distribution
```
The membership type appears to have the great impact on ride duration as displayed by the visualization. This was followed by month and bike type. 


