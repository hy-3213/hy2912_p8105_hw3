---
title: "hy2912_p8105_hw3"
author: "Helen Yousaf"
date: "2024-10-07"
output: github_document
---
```{r}
library(readr)
library(tidyverse)
library(ggridges)
library(dplyr)
```

# Problem 2 
#### MIMS Data

Importing MIMS Demographic data
```{r}
MIMS_dg_df = 
  read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/MIMS.dg.csv", 
           skip = 4, na = c(".", "NA", ""), 
    col_types = cols(
      'SEQN' = col_character(),
      `sex` = col_character(),
      `age` = col_integer(),
      `BMI` = col_double(),
      `education` = col_character(),
    )
  )
```

```{r}
names(MIMS_dg_df)
MIMS_dg_df = janitor::clean_names(MIMS_dg_df)
```

Importing MIMS Accelerometer data 
```{r}
MIMS_ac_df = 
  read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/MIMS.ac.csv", 
           na = c(".", "NA", ""), 
     col_types = cols(
      'SEQN' = col_character(),
    )
  )       
```

```{r}
names(MIMS_ac_df)
MIMS_ac_df = janitor::clean_names(MIMS_ac_df)
```

Joining data sets to form MIMS_comb_df
```{r}
MIMS_comb_df = 
  left_join (MIMS_dg_df, MIMS_ac_df, by = "seqn") 
```

```{r}
MIMS_comb_df = 
  drop_na(MIMS_comb_df) |>
  filter ("age" >= 21) |>
  mutate(across(c(sex, education), as.factor)
)
```

Gender and Education Summary Table 
```{r}
gender_ed_df <- MIMS_comb_df |>
  group_by(education, sex) |>
  summarise(count = n()) |>
  pivot_wider(names_from = sex, values_from = count, values_fill = 0)
```

```{r}
gender_ed_df
```
Visualization of the Age-Sex Distribution by Education Level
```{r}
ggplot(MIMS_comb_df, aes(x = age, fill = sex)) +
  geom_histogram(position = "dodge", binwidth = 10, alpha = 0.5) +
  facet_wrap(~ education) +
  labs(title = "Age-Sex Distribution By Education Level",
       x = "Age (years)",
       y = "Count") +
  theme_minimal()
```
Total activity dataset 
```{r}
total_activity_df <- MIMS_comb_df |>
  group_by(seqn, age, sex, education) |>
  summarise(total_activity = sum(min1:min1440, na.rm = TRUE)) 
```
```{r}
total_activity_df
```
Plot of total activities against age, by sex and education
```{r}
ggplot(total_activity_df, aes(x = age, y = total_activity, color = sex)) +
  geom_point() +
  geom_smooth(method = "loess") +
  facet_wrap(~ education) +
  labs(x = "Age", y = "Total Activity", title = "Total Activity Against Age, by Gender and Education Level") +
  theme_minimal()
```
# Problem 3
#### Citi Bike Data 

Loading data sets 
```{r}
Jan2020_df = read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/Jan2020.CITI.csv", na = c(".", "NA", ""))
Jul2020_df = read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/July2020.CITI.csv", na = c(".", "NA", ""))
Jan2024_df = read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/Jan2024.CITI.csv", na = c(".", "NA", ""))
Jul2024_df = read_csv(file = "/Users/helenyousaf/Desktop/hy2912_p8105_hw3/July2024.CITI.csv", na = c(".", "NA", ""))
```

Basic cleaning of data sets
```{r}
Jan2020_df = 
  janitor::clean_names (Jan2020_df)
```
```{r}
Jan2020_df = 
  drop_na(Jan2020_df) |>
  mutate (date = "Jan 2020")
```
```{r}
Jul2020_df = janitor::clean_names (Jul2020_df)
```
```{r}
Jul2020_df = 
  drop_na(Jul2020_df)|>
  mutate (date = "July 2020")
```
```{r}
Jan2024_df = janitor::clean_names (Jan2024_df) 
```
```{r}
Jan2024_df = 
  drop_na(Jan2024_df) |>
  mutate (date = "Jan 2024")
```
```{r}
Jul2024_df = janitor::clean_names (Jul2024_df)
```
```{r}
Jul2024_df = 
  drop_na(Jul2024_df) |> 
  mutate (date = "July 2024")
```
Binding rows to recreate one data set for Citi Bike data
```{r}
citi_df = 
  bind_rows (Jan2020_df, Jul2020_df, Jan2024_df, Jul2024_df) |>
  rename (id = ride_id, bike= rideable_type, day = weekdays, start_station = start_station_name, end_station = end_station_name, 
  rider = member_casual) 
```
```{r}
citi_df |>
   mutate(
    bike = 
      case_match(
        bike, 
        "electric_bike" ~ "electric", 
        "classic_bike" ~ "classic")
   )
```

```{r}
total_rider_df <- citi_df |>
  group_by(rider, date) |>
  summarise(count = n()) |>
  pivot_wider(names_from = rider, values_from = count, values_fill = 0)
```
```{r}
total_rider_df
```
```{r}
pop_start_df <- citi_df |>
  group_by (date = "July 2024") |>
  summarise(count = n()) |>
  pivot_wider(names_from = date, values_from = count, values_fill = 0)
```

July 2024 data set
```{r}
Jul_2024_df <- citi_df |>
  filter(date == "July 2024")
```

Popular Stations data set
```{r}
pop_start_df <- Jul_2024_df |> 
  group_by(start_station) |>
  summarise(ride_count = n()) |>
  arrange(desc(ride_count))
```

5 Most Popular Starting Stations 
```{r}
five_pop_start_df <- head(pop_start_df, 5)
```

```{r}
five_pop_start_df
```
```{r}
median_df <- citi_df |>
separate (date, c("month", "year"))
```

Calculating median ride duration per date variable factor 
```{r}
day_median_df <- median_df |>
  group_by(day)|>
  summarise(day_median_duration = median(duration))
```

```{r}
month_median_df <- median_df |>
  group_by(month)|>
  summarize(month_median_duration = median(duration))
```

```{r}
year_median_df <- median_df |>
  group_by(year)|>
  summarize(year_median_duration = median(duration))
```

Creating individual plots 
```{r}
day_plot <- ggplot(day_median_df, aes(x = day, y = day_median_duration)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Median Ride Duration by Day of the Week",
       x = "Day of the Week",
       y = "Median Ride Duration (minutes)") +
  theme_minimal()
```
```{r}
month_plot <- ggplot(month_median_df, aes(x = month, y = month_median_duration)) +
  geom_bar(stat = "identity", fill = "green") +
  labs(title = "Median Ride Duration by Month",
       x = "Month",
       y = "Median Ride Duration (minutes)") +
  theme_minimal()
```

```{r}
year_plot <- ggplot(year_median_df, aes(x = year , y = year_median_duration)) +
  geom_bar(stat = "identity", fill = "pink") +
  labs(title = "Median Ride Duration by Month",
       x = "Year",
       y = "Median Ride Duration (minutes)") +
  theme_minimal()
```

```{r}
library(patchwork)
```

```{r}
(day_plot + month_plot) / year_plot
```





